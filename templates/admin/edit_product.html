{% extends "admin/base.html" %}

{% block page_title %}Editar Produto{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Editar Produto</h2>
    <a href="{{ url_for('admin_products') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Voltar
    </a>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="name" class="form-label">Nome do Produto *</label>
                                <input type="text" class="form-control" id="name" name="name" value="{{ product.name }}" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="price" class="form-label">Preço (Kz) *</label>
                                <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" value="{{ product.price }}" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="category" class="form-label">Categoria *</label>
                                <select class="form-select" id="category" name="category" required>
                                    <option value="">Selecione uma categoria</option>
                                    {% for category in categories %}
                                        <option value="{{ category.name }}" {% if category.name == product.category %}selected{% endif %}>
                                            {{ category.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="stock_quantity" class="form-label">Quantidade em Estoque</label>
                                <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" min="0" value="{{ product.stock_quantity }}">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="image_url" class="form-label">URL da Imagem</label>
                        <input type="url" class="form-control" id="image_url" name="image_url" value="{{ product.image_url or '' }}" placeholder="https://exemplo.com/imagem.jpg">
                        <div class="form-text">Cole aqui o link da imagem do produto</div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Descrição</label>
                        <textarea class="form-control" id="description" name="description" rows="4" placeholder="Descreva o produto...">{{ product.description or '' }}</textarea>
                    </div>

                    <div class="mb-3 form-check">
                        <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if product.is_active %}checked{% endif %}>
                        <label class="form-check-label" for="is_active">
                            Produto ativo (visível na loja)
                        </label>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('admin_products') }}" class="btn btn-outline-secondary me-md-2">Cancelar</a>
                        <button type="submit" class="btn btn-admin">
                            <i class="fas fa-save me-2"></i>Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Pré-visualização</h6>
            </div>
            <div class="card-body">
                <div id="preview" class="text-center">
                    <div id="preview-image" style="width: 100%; height: 200px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; border-radius: 8px; margin-bottom: 15px;">
                        {% if product.image_url %}
                            <img src="{{ product.image_url }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" onerror="this.parentNode.innerHTML='<i class=\'fas fa-exclamation-triangle fa-2x text-warning\'></i><br><small>Erro ao carregar imagem</small>'">
                        {% else %}
                            <i class="fas fa-image fa-3x text-muted"></i>
                        {% endif %}
                    </div>
                    <h6 id="preview-name">{{ product.name }}</h6>
                    <p id="preview-price" class="text-primary fw-bold">{{ "{:,.2f}".format(product.price) }} Kz</p>
                    <span id="preview-category" class="badge bg-secondary">{{ product.category }}</span>
                    <div class="mt-2">
                        <span id="preview-status" class="badge bg-{{ 'success' if product.is_active else 'secondary' }}">
                            {{ 'Ativo' if product.is_active else 'Inativo' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0">Informações</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled small">
                    <li><strong>ID:</strong> {{ product.id }}</li>
                    <li><strong>Criado em:</strong> {{ product.created_at[:10] if product.created_at else 'N/A' }}</li>
                    <li><strong>Atualizado em:</strong> {{ product.updated_at[:10] if product.updated_at else 'N/A' }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('name');
    const priceInput = document.getElementById('price');
    const categorySelect = document.getElementById('category');
    const imageInput = document.getElementById('image_url');
    const isActiveInput = document.getElementById('is_active');
    
    const previewName = document.getElementById('preview-name');
    const previewPrice = document.getElementById('preview-price');
    const previewCategory = document.getElementById('preview-category');
    const previewImage = document.getElementById('preview-image');
    const previewStatus = document.getElementById('preview-status');
    
    function updatePreview() {
        previewName.textContent = nameInput.value || 'Nome do produto';
        previewPrice.textContent = priceInput.value ? 
            parseFloat(priceInput.value).toLocaleString('pt-PT', {minimumFractionDigits: 2}) + ' Kz' : 
            '0,00 Kz';
        previewCategory.textContent = categorySelect.value || 'Categoria';
        
        if (imageInput.value) {
            previewImage.innerHTML = `<img src="${imageInput.value}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" onerror="this.parentNode.innerHTML='<i class=\\'fas fa-exclamation-triangle fa-2x text-warning\\'></i><br><small>Erro ao carregar imagem</small>'">`;
        } else {
            previewImage.innerHTML = '<i class="fas fa-image fa-3x text-muted"></i>';
        }
        
        previewStatus.textContent = isActiveInput.checked ? 'Ativo' : 'Inativo';
        previewStatus.className = `badge bg-${isActiveInput.checked ? 'success' : 'secondary'}`;
    }
    
    nameInput.addEventListener('input', updatePreview);
    priceInput.addEventListener('input', updatePreview);
    categorySelect.addEventListener('change', updatePreview);
    imageInput.addEventListener('input', updatePreview);
    isActiveInput.addEventListener('change', updatePreview);
});
</script>
{% endblock %}