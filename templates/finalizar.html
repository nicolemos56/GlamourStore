{% extends "base.html" %}

{% block title %}Finalizar - Nc Glamourstore{% endblock %}

{% block content %}
<div class="col-12">
    <div class="container py-4">
        <!-- Header Section -->
        <div class="text-center mb-4">
            <h2 class="fw-bold">Finalizar</h2>
            <p class="text-muted">A sua loja online</p>
        </div>

        <div class="row">
            <!-- Left Column - Order Methods -->
            <div class="col-lg-4 mb-4">
                <!-- Delivery Method -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0 fw-bold">Método de Entrega</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="delivery_method" id="pickup" value="pickup" checked>
                            <label class="form-check-label" for="pickup">
                                Levantar na loja
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="delivery_method" id="home_delivery" value="home_delivery">
                            <label class="form-check-label" for="home_delivery">
                                Entrega numa morada
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0 fw-bold">Método de Pagamento</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="payment_method" id="multicaixa" value="multicaixa">
                            <label class="form-check-label" for="multicaixa">
                                Multicaixa
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="payment_method" id="mfiway" value="mfiway">
                            <label class="form-check-label" for="mfiway">
                                MFIWAY
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment_method" id="cash_on_pickup" value="cash_on_pickup" checked>
                            <label class="form-check-label" for="cash_on_pickup">
                                Pagar no levantamento
                            </label>
                            <small class="text-muted d-block">Dinheiro e Transferência Bancária</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Column - Personal Data -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0 fw-bold">Dados Pessoais</h5>
                    </div>
                    <div class="card-body">
                        <form id="checkout-form">
                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="first_name" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="first_name" placeholder="Primeiro e último">
                                </div>
                                <div class="col-6">
                                    <label for="nif" class="form-label">NIF</label>
                                    <input type="text" class="form-control" id="nif" placeholder="NIF para faturação">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-6">
                                    <label for="phone" class="form-label">Telemóvel</label>
                                    <input type="tel" class="form-control" id="phone" placeholder="Telemóvel">
                                </div>
                                <div class="col-6">
                                    <label for="email" class="form-label">E-Mail</label>
                                    <input type="email" class="form-control" id="email" placeholder="E-Mail">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="observations" class="form-label">Observações</label>
                                <textarea class="form-control" id="observations" rows="3" placeholder="Necessita de dizer algo?"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0 fw-bold">Resumo da Encomenda</h5>
                    </div>
                    <div class="card-body">
                        {% if cart_items %}
                            {% for item in cart_items %}
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div>
                                        <h6 class="mb-0 fw-bold">{{ item.product.name }}</h6>
                                        <small class="text-muted">{{ item.quantity }}x {{ "{:,.2f}".format(item.product.price) }} Kz</small>
                                    </div>
                                </div>
                            {% endfor %}
                            
                            <hr>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0 fw-bold">Total</h5>
                                <h5 class="mb-0 fw-bold text-primary">{{ "{:,.2f}".format(cart_total) }} Kz</h5>
                            </div>
                        {% else %}
                            <p class="text-muted">Carrinho vazio</p>
                        {% endif %}

                        <!-- Delivery Info -->
                        <div class="text-center mb-3">
                            <div class="bg-light p-3 rounded">
                                <i class="fas fa-truck fa-2x text-muted mb-2"></i>
                                <p class="mb-1 fw-bold">Entrega do Produto</p>
                                <small class="text-muted">Receber um e-mail para levantar o seu pedido.</small>
                            </div>
                        </div>

                        <!-- Finalize Button -->
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary btn-lg" onclick="finalizeOrder()">
                                FINALIZAR
                            </button>
                        </div>

                        <!-- Free Delivery Info -->
                        <div class="text-center mt-3">
                            <small class="text-muted">
                                Entregas grátis para encomendas superiores a<br>
                                <strong>60.000,00 Kz</strong>
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Continue Shopping -->
                <div class="text-center mt-3">
                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Continuar Comprando
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function finalizeOrder() {
    const firstName = document.getElementById('first_name').value;
    const phone = document.getElementById('phone').value;
    const email = document.getElementById('email').value;
    
    if (!firstName || !phone || !email) {
        alert('Por favor, preencha os campos obrigatórios: Nome, Telemóvel e E-Mail');
        return;
    }
    
    // Simulate order processing
    const deliveryMethod = document.querySelector('input[name="delivery_method"]:checked').value;
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
    
    let message = `Pedido recebido com sucesso!\n\n`;
    message += `Nome: ${firstName}\n`;
    message += `Telemóvel: ${phone}\n`;
    message += `E-Mail: ${email}\n\n`;
    message += `Método de entrega: ${deliveryMethod === 'pickup' ? 'Levantar na loja' : 'Entrega em casa'}\n`;
    message += `Método de pagamento: ${getPaymentMethodText(paymentMethod)}\n\n`;
    message += `Total: {{ "{:,.2f}".format(cart_total) }} Kz\n\n`;
    message += `Receberá um e-mail de confirmação em breve.`;
    
    alert(message);
    
    // Clear cart and redirect
    fetch('/clear_cart', { method: 'POST' })
        .then(() => {
            window.location.href = '/';
        });
}

function getPaymentMethodText(method) {
    switch(method) {
        case 'multicaixa': return 'Multicaixa';
        case 'mfiway': return 'MFIWAY';
        case 'cash_on_pickup': return 'Pagar no levantamento';
        default: return method;
    }
}
</script>
{% endblock %}